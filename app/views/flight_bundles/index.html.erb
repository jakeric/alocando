<div class="wrapper">

  <!-- container on top with the search bar, the recap and filters  -->
  <div class="container results__container-head">

    <!-- search input -->
    <div class="results__search-input">
      <div class="results__search-form">
        <form action="/flight_bundles" method="get" class="form-inline form-homepage">

          <label class="sr-only" for="inlineFormInput">Your city</label>
          <input type="text" required class="input-padding form-control mb-2 mr-sm-2 awesomplete" id="inlineFormInputCity" placeholder="Your city" name="your-city" list="mylist" style="color: black">

          <label class="sr-only" for="inlineFormInputName2">Your friend's city</label>
          <input type="text" required class="input-padding form-control mb-2 mr-sm-2 awesomplete" id="inlineFormInputFriendCity" placeholder="Your friend's city" name="friends-city" list="mylist" style="color: black">

          <!-- list for the autocomplete -->
          <datalist id="mylist">
            <% City.all.each do |city| %>
            <option> <%= "#{city.name} (#{city.country})" %> </option>
            <% end %>
          </datalist>

          <label class="sr-only" for="inlineFormInput">Start and Return Date</label>

          <div class="buoy-show-datepicker input-padding" >
            <div class="datepicker-field">
              <input type="text" required class="form-control mb-2 mr-sm-2" id="inlineFormStartInputDate" placeholder="Start and Return Date" name="start-date" style="color: black">
            </div>
          </div >
          <div class="datepicker-submit">
            <button type="submit" class="btn btn-orange mb-2">Search</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Above is closing of search input -->

    <div class="results__search-recap">
      <h3>
        <%= @bundle.size %> results flying from
        <strong><%= params["your-city"] %></strong>
        and
        <strong><%= params["friends-city"] %></strong>,
        from
        <strong><%= Date.parse(params["start-date"].split(" to ")[0]).strftime("%d/%m/%Y") %></strong>
        to
        <strong><%= Date.parse(params["start-date"].split(" to ")[1]).strftime("%d/%m/%Y") %></strong>
      </h3>
    </div>
  </div>
  <!-- above closing container with the search bar and filters  -->

  <!-- XXXX NEW CONTAINER - WITH RESULTS AND CITY INFO -->
  <div class="container results__container-results">

    <!-- left side of the screen, with the results cards  -->
    <div class="results__results-list-side">
      <div class="row results__results-list-row">
        <% @bundle.each do |flight_bundle| %>
        <div class=" link-color-hover col-xs-12" >

          <%= link_to (render 'components/bundle_card', flight_bundle: flight_bundle), flight_bundles_path(flight_bundle: flight_bundle, params: @search_params), remote: true %>

        <!-- Button for the Modal -->

          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Book
          </button>

          <!-- Ruby code for the Modal -->

          <% your_price = flight_bundle.flight_bundle_flights[0].flight.price + flight_bundle.flight_bundle_flights[1].flight.price %>
          <% friends_price = flight_bundle.flight_bundle_flights[2].flight.price + flight_bundle.flight_bundle_flights[3].flight.price %>
          <% total_price = flight_bundle.total_price %>
          <% shared_price = flight_bundle.total_price / 2 %>
          <% debt = 0 %>

          <% if your_price > friends_price %>
          <%  debt = your_price - shared_price %>
          <%  own_message = "Your friend owes you #{debt} €." %>
          <% else %>
          <%  debt = friends_price - shared_price %>
          <%  own_message = "You owe your friend #{debt} €." %>
          <% end %>

          <!-- Modal -->
          <div class="modal fade modal-book" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog book-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header ">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="exampleModalLabel">Book your flight</h5>
              </div>

              <div class="modal-body modal-body-cover">
                <div class="container-modal-text">
                  <div class="row">
                    <div class="col-md-6 text-center">
                      <h4>Please choose your starting location</h4>
                      <button type="button" class="btn btn-primary btn-modal" ><%= params["your-city"].split(" (")[0] %></button>
                      <button type="button" class="btn btn-primary btn-modal"><%= params["friends-city"].split(" (")[0] %></button>
                      <p>Your flight: <%= your_price %> € </p>
                      <p>Your friends flight: <%= friends_price %> € </p>
                      <p>Be fair and share the bill. </p>
                      <p><%= own_message %></p>
                    </div>
                    <div class="col-md-6">
                      <div class="container-modal-image">
                        <%= image_tag "frie.png" %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>


        </div>
        <% end %>a
      <div class="col-xs-12">
        <div class="results-loadmore-circle">
          <i class="fas fa-circle"></i>
          <i class="fas fa-circle"></i>
          <i class="fas fa-circle"></i>
        </div>

      </div>
    </div>
  </div>
  <!-- above is the closing div of the LEFT side of the screen  -->

  <!-- right side of the screen, with city info  -->
  <div class="results__results-infos-side">
    <div class="row results__results-infos-row" id="destination_infos">

      <%= render 'components/destination_card', flight_bundle: @bundle_id %>

    </div>
  </div>
  <!-- above is the closing div of the RIGHT side of the screen  -->

</div>
<!-- above is the closing div of the container results  -->

</div>
